---
title: "MLB 2017"
author: "Jensen Holm & Kyle Knapp"
date: "2022-11-07"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Libraries
```{r include=TRUE, message=FALSE, warning=FALSE}
library(grid)
library(tidyverse)
library(lubridate)
library(boot)
```

## Read in the data
```{r include = TRUE}
# should work with any computer as long as you have
# the data folder to go with this
dataFilePath <- str_c(getwd(), "/data/", sep = "")

# function to make importing data into this project
# seamless
importCSV <- function(fileName) {
  read.csv(str_c(dataFilePath, str_c(fileName, ".csv", sep = ""), sep = ""))
}
```


```{r include = TRUE}
statCast <- importCSV("statcast2017")
bbref <- importCSV("bbref2017")
trackman <- importCSV("trackman")
```


## Joining the two datasets together with dplyr and stringr
```{r include=TRUE}
# str_c() is a stirngr function
statCastName <- statCast %>% mutate(
  Name = str_c(
    str_replace_all(first_name, " ", ""), 
    str_replace_all(last_name, " ", ""), 
    sep = " "
    )
)  

bsbl <- left_join(
  statCastName, 
  bbref, 
  by = "Name"
)
```


```{r include = TRUE, warning=FALSE, message=FALSE}
# without applying this filter on the data set, there were
# a lot of players with too few plate appearances messing 
bsblSub <- bsbl %>% subset(attempts > 100)  

bsblSub %>% ggplot(aes(
  x = anglesweetspotpercent, 
  y = avg_distance, 
  color = attempts, 
  alpha = 0.5
  )) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(
    title = "Average Hit Distance as a funciton of launch angle sweet spot %" ,
    x = "Launch Angle Sweet Spot %",
    y = "Average Hit Distance (ft.)"
  )
```

```{r, include=TRUE, message=FALSE, warning=FALSE}
# heatmap of batting average compared to avg_hit_speed and avg_laungh_angle
bsblSub %>% ggplot(aes(
  x = round(avg_hit_angle, digits=0),
  y = round(avg_hit_speed, digits=0),
  fill = BA
)) + 
  geom_tile() + 
  labs(
    title = "Average Hit Speed vs Average Hit angle grouped by BA",
    x = "Average Hit Angle",
    y = "Average Hit Speed"
  )


bsblSub %>% ggplot(aes(x = HR, y = RBI)) + geom_density_2d_filled() +
  labs(
    title = "Runs Batted In as a function of Home Runs in 2017 (Density Plot)"
  )
```

# making strikezone visualization with trackman dataset
```{r include=TRUE}
# constanst for the strikezone were decided based on this
# article -> https://www.baseballprospectus.com/news/article/40891/prospectus-feature-the-universal-strike-zone/

in2ft <- function(inches) {
  inches / 12
}

leftSZ <- in2ft(-(19.94 / 2))
rightSZ <- in2ft(19.94 / 2)
heightSZ <- in2ft(44.08)
minySZ <- in2ft(18.29)
```


```{r include=TRUE}
strikeZonePlot <- function(dataset) {
  dataset %>% ggplot(
    aes(
      x = PlateLocSide,
      y = PlateLocHeight,
      color = TaggedPitchType
    ) 
  ) + geom_point() + 
    geom_rect(
      xmin = leftSZ,
      xmax = rightSZ,
      ymin = minySZ,
      ymax = heightSZ,
      alpha = 0,
      color = "black"
    )
}
```


# Strike Zone graph filtered with only pitches thrown from Right Handed Pitchers
```{r include=TRUE, message=FALSE, warning=FALSE}
trackman %>% subset(PitcherThrows == "Right") %>% strikeZonePlot()
```


# Strike Zone graph filtered with only pitches thrown from Left Handed Pitchers
```{r include=TRUE, message=FALSE, warning=FALSE}
trackman %>% subset(PitcherThrows == "Left") %>% strikeZonePlot()
```



## T-Test between the Colorado Rockies Average hit speed and the rest of the MLB
```{r}
# t test
colorado <- bsbl %>% subset(Team == "Colorado")
everyoneElse <- bsbl %>% subset(Team != "Colorado")

t.test(
  colorado$avg_hit_speed, 
  everyoneElse$avg_hit_speed
)
```

# Non-Parametric BootStrap
```{r include=TRUE, message=FALSE, warning=FALSE}
bsbl2 <- na.omit(bsbl)

set.seed(10)

x <- c(bsbl2$H)

#define function to calculate mean
meanFunc <- function(x,i){mean(x[i])}

#calculate standard error using 100 bootstrapped samples
boot(x, meanFunc, 100)

bsbl2 %>% ggplot(aes(x = H)) + 
 geom_histogram()
```

# Parametric BootStrap
```{r include=TRUE}

paramBoots <- function(data_set, num_samples) {
  pBoots <- matrix(
    NA, nrow = length(data_set), ncol = num_samples
  )
  for (i in 1:num_samples) {
    pBoots[, i] <- rnorm(
      n = length(data_set),
      mean = mean(data_set),
      sd = sd(data_set)
    )
  }
  return (pBoots)
}


# for the func argument in this function, pass in a function
# 'mean' or 'median'
paramBootsStat <- function(func, parameterBoots) {
  pbs <- vector(length = ncol(parameterBoots))
  for (i in 1:ncol(parameterBoots)) {
    pbs[i] <- func(parameterBoots[,i])
  }
  return (pbs)
}

```

```{r include=TRUE}
b <- paramBoots(bsbl2$H,100)
print(length(b))
paramBootsStat(median, b)
```


# Pivoting data into wide format
<br>
This would create a new dataset with columns for each unique value in the Team column, <br> 
and the values for barrels per plate appearance <br> 
column would be spread across these new columns. <br>
<br>
```{r include=TRUE}
wideBsbl <- pivot_wider(
  bsblSub, 
  names_from = Team, 
  values_from = brl_pa
)
```

# utilizing lubridate functions with our data
```{r include=TRUE, R.options=list(max.print=10)}

# creating the dates vector
dates <- trackman$Date %>% month()

# adding it to our dataframe
trackman$month = month.abb[dates]

trackman$month

```

# Data Dictionary
```{r indluce=FALSE}

dataDictionary <- tibble(Variable = colnames(bsbl),
                         Description = c("Last name of player",
                                         "First name of player",
                                         "Player identification number",
                                         "Number of batting attempts",
                                         "Average launch angle of the ball off the bat (degrees)",
                                         "Percentage of hits where the launch angle of the ball fell within the sweet spot",
                                         "Maximum ball speed of a players single hit (mph)",
                                         "Average ball speed of a player's hits (mph)",
                                         "Fly ball line drive percentage",
                                         "Ground ball percentage",
                                         "Maximum distance of a ball hit (feet)",
                                         "Average distance of a ball hit (feet)",
                                         "Average distance of a home run (feet)",
                                         "ev95Plus",
                                         "ev95percent",
                                         "Number of barrels hit in a season",
                                         "Barrel percentage",
                                         "Barrels per plate appearance",
                                         "Player's full name",
                                         "Player's ID number",
                                         "Player's baseball reference ID number",
                                         "Season year",
                                         "Player's age",
                                         "Level of play",
                                         "Team player is on",
                                         "Games played",
                                         "Plate appearences",
                                         "At-bats",
                                         "Runs scored",
                                         "Number of hits",
                                         "Singles",
                                         "Doubles",
                                         "Triples",
                                         "Home runs",
                                         "Runs batted in",
                                         "Walks",
                                         "Intentional walks",
                                         "Unintentional walks",
                                         "Strikeouts",
                                         "Hit by pitch",
                                         "Shutouts",
                                         "Sacrifice Flies",
                                         "Ground into double play",
                                         "Stolen bases",
                                         "Caught Stealing",
                                         "Batting average",
                                         "On base percenatage",
                                         "Slugging percentage",
                                         "On base plus slugging percentage"),
                         Type = map_chr(bsbl, .f = function(x){typeof(x)[1]}),
                         Class = map_chr(bsbl, .f = function(x){class(x)[1]}))

# printing it out nicely
knitr::kable(dataDictionary)
```




