---
title: "MLB 2017"
author: "Jensen Holm & Kyle Knapp"
date: "2022-11-07"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Libraries
```{r include=TRUE, message=FALSE, warning=FALSE}
library(grid)
library(tidyverse)
library(boot)
```

## Read in the data
```{r include = TRUE}

dataFilePath <- str_c(getwd(), "/data/", sep = "")

importCSV <- function(fileName) {
  read.csv(str_c(dataFilePath, str_c(fileName, ".csv", sep = ""), sep = ""))
}

statCast <- importCSV("statcast2017")
bbref <- importCSV("bbref2017")

# purpose of the trackman data is so that we can do a lubridate function with dates
trackman <- importCSV("trackman")
```


## Joining the two datasets together with dplyr and stringr
```{r include=TRUE}
# str_c() is a stirngr function
statCastName <- statCast %>% mutate(
  Name = str_c(
    str_replace_all(first_name, " ", ""), 
    str_replace_all(last_name, " ", ""), 
    sep = " ")
)  

bsbl <- left_join(
  statCastName, 
  bbref, 
  by = "Name"
)
```


```{r include = TRUE, warning=FALSE, message=FALSE}
# without applying this filter on the data set, there were
# a lot of players with too few plate appearances messing 
bsblSub <- bsbl %>% subset(attempts > 100)  

bsblSub %>% ggplot(aes(
  x = anglesweetspotpercent, 
  y = avg_distance, 
  color = attempts, 
  alpha = 0.5
  )) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(
    title = "Average Hit Distance as a funciton of launch angle sweet spot %" ,
    x = "Launch Angle Sweet Spot %",
    y = "Average Hit Distance (ft.)"
  )
```

```{r, include=TRUE, message=FALSE, warning=FALSE}
# heatmap of batting average compared to avg_hit_speed and avg_laungh_angle
bsblSub %>% ggplot(aes(
  x = round(avg_hit_angle, digits=0),
  y = round(avg_hit_speed, digits=0),
  fill = BA
)) + geom_tile()

bsblSub %>% ggplot(aes(x = HR, y = RBI)) + geom_density_2d_filled()


# Group by mean using dplyr
mean_age_bsbl <- bsbl %>% group_by(Age) %>% 
  summarise(brl_pct=mean(BA), hr=mean)

```

# making strikezone visualization with trackman dataset
```{r include=TRUE}


in2ft <- function(inches) {
  inches / 12
}

# strike zone dimensions governed by https://www.baseballprospectus.com/news/article/40891/prospectus-feature-the-universal-strike-zone/
leftSZ <- in2ft(-(19.94 / 2))
rightSZ <- in2ft(19.94 / 2)
heightSZ <- in2ft(44.08)
minySZ <- in2ft(18.29)

strikeZonePlot <- function(dataset) {
  dataset %>% ggplot(
    aes(
      x = PlateLocSide,
      y = PlateLocHeight,
      color = TaggedPitchType
    ) 
  ) + geom_point() + 
    geom_rect(
      xmin = leftSZ,
      xmax = rightSZ,
      ymin = minySZ,
      ymax = heightSZ,
      alpha = 0,
      color = "black"
    )
}

trackman %>% subset(PitcherThrows == "Right") %>% strikeZonePlot()
trackman %>% subset(PitcherThrows == "Left") %>% strikeZonePlot()

```



## T-Test between the Colorado Rockies Average hit speed and the rest of the MLB
```{r}
# t test
colorado <- bsbl %>% subset(Team == "Colorado")
everyoneElse <- bsbl %>% subset(Team != "Colorado")

t.test(
  colorado$avg_hit_speed, 
  everyoneElse$avg_hit_speed
)
```

# Non-Parametric BootStrap
```{r include=TRUE, message=FALSE, warning=FALSE}
bsbl2 <- na.omit(bsbl)

set.seed(10)

x <- c(bsbl2$H)

#define function to calculate mean
meanFunc <- function(x,i){mean(x[i])}

#calculate standard error using 100 bootstrapped samples
boot(x, meanFunc, 100)

bsbl2 %>% ggplot(aes(x = H)) + 
 geom_histogram()
```

# Parametric BootStrap
```{r include=TRUE}
# Number of bootstrap samples
B <- 100

# Instantiating matrix for bootstrap samples
paramBoots <- matrix(NA, 
                     nrow = length(bsbl2), 
                     ncol = B
)

# Sampling with replacement B times
for(b in 1:B) {
paramBoots[, b] <- rnorm(
  n = length(bsbl2), 
  mean = mean(bsbl2$H), 
  sd = sd(bsbl2$H)
  )
}

paramBootMedians <- vector(length = B)
for(a in 1:B){
 paramBootMedians[a] <- mean(paramBoots[,a])
}

sd(paramBootMedians)
```

# Pivoting data into wide format
<br>
This would create a new dataset with columns for each unique value in the Team column, <br> 
and the values for barrels per plate appearance <br> 
column would be spread across these new columns. <br>
<br>
```{r include=TRUE}
wideBsbl <- pivot_wider(
  bsblSub, 
  names_from = Team, 
  values_from = brl_pa
)
```




