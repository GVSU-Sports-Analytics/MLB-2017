---
title: "MLB 2017"
author: "Jensen Holm & Kyle Knapp"
date: "2022-11-07"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Libraries
```{r include=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(boot)
```


## Read in the data
```{r include = TRUE}
statCast <- read.csv(str_c(getwd(), "/data/statcast2017.csv", sep = ""))
bbref <- read.csv(str_c(getwd(), "/data/bbref2017.csv", sep = ""))
```


## Joining the two datasets together with dplyr
```{r include=TRUE}
statCastName <- statCast %>% mutate(
  Name = str_c(
    str_replace_all(
      first_name, " ", ""), 
    str_replace_all(
      last_name, " ", ""), 
    sep = " "))  

bsbl <- left_join(
  statCastName, 
  bbref, 
  by = "Name"
)
```


## EDA

```{r}
glimpse(bsbl)
```



```{r include = TRUE, warning=FALSE, message=FALSE}
# without applying this filter on the data set, there were
# a lot of players with too few plate appearances messing 
bsblSub <- bsbl %>% subset(attempts > 100)  

bsblSub %>% ggplot(aes(x = anglesweetspotpercent, y = avg_distance, color = attempts, alpha = 0.5)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(
    title = "Average Hit Distance as a funciton of launch angle sweet spot %" ,
    x = "Launch Angle Sweet Spot %",
    y = "Average Hit Distance (ft.)"
  )
```

```{r, include=TRUE, message=FALSE, warning=FALSE}
# plot batting average by average exit velocity, something that I could not do without
# having mergeed the datasets

bsblSub %>% ggplot(aes(x = BA, y = avg_hit_speed, color = barrels, alpha = 0.5)) + 
  geom_point() +
  geom_smooth(method = "lm") + 
  labs (
    title = "Average Hit Speed as a function of Batting Average",
    x = "Batting Average",
    y = "Average Hit Speed"
  )
```

## T-Test between the Colorado Rockies Average hit speed and the rest of the MLB
```{r}
# t test
colorado <- bsbl %>% subset(Team == "Colorado")
everyoneElse <- bsbl %>% subset(Team != "Colorado")

t.test(colorado$avg_hit_speed, everyoneElse$avg_hit_speed)
```

# Non-Parametric BootStrap
```{r include=TRUE, message=FALSE, warning=FALSE}
bsbl2 <- na.omit(bsbl)

set.seed(10)

x <- c(bsbl2$H)

#define function to calculate mean
meanFunc <- function(x,i){mean(x[i])}

#calculate standard error using 100 bootstrapped samples
boot(x, meanFunc, 100)

bsbl2 %>% ggplot(aes(x = H)) + 
 geom_histogram()
```

# Parametric BootStrap
```{r include=TRUE}
# Number of bootstrap samples
B <- 100

# Instantiating matrix for bootstrap samples
paramBoots <- matrix(NA, nrow = length(bsbl2), ncol = B)

# Sampling with replacement B times
for(b in 1:B) {
paramBoots[, b] <- rnorm(n = length(bsbl2), mean = mean(bsbl2$H), sd = sd(bsbl2$H))
}

paramBootMedians <- vector(length = B)
for(a in 1:B){
 paramBootMedians[a] <- mean(paramBoots[,a])
}

sd(paramBootMedians)
```


